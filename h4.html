<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H4 - Tervezés</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #eef2ff; padding: 20px; color: #333; margin: 0; line-height: 1.6; }
        .card { background: white; max-width: 900px; margin: 0 auto; padding: 40px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); border-top: 6px solid #4f46e5; }
        h1 { color: #312e81; text-align: center; margin-bottom: 10px; }
        h2 { color: #4338ca; background: #e0e7ff; padding: 10px 15px; border-radius: 6px; margin-top: 50px; border-left: 5px solid #4f46e5; }
        h3 { color: #4f46e5; margin-top: 30px; border-bottom: 1px solid #e0e7ff; padding-bottom: 5px; }
        
        p { text-align: justify; margin-bottom: 15px; }

        /* Táblázat */
        table { width: 100%; border-collapse: collapse; margin: 20px 0; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        th { background: #312e81; color: white; padding: 12px; text-align: left; }
        td { padding: 12px; border-bottom: 1px solid #e2e8f0; }
        tr:nth-child(odd) { background: #eef2ff; }

        /* SVG Tárolók */
        .svg-container {
            display: flex;
            justify-content: center;
            margin: 30px 0;
            background: #fff;
            padding: 20px;
            border: 1px solid #e0e7ff;
            border-radius: 8px;
            overflow-x: auto; 
        }

        /* UI Mockup */
        .ui-mockup {
            display: flex; border: 2px solid #333; height: 300px; width: 100%; max-width: 600px; margin: 20px auto; background: #fff;
        }
        .ui-left { width: 70%; border-right: 2px solid #333; padding: 10px; display: grid; grid-template-columns: repeat(5, 1fr); gap: 5px; align-content: center; }
        .seat { background: #ddd; height: 20px; border-radius: 4px; }
        .seat.red { background: #ef4444; }
        .seat.green { background: #22c55e; }
        .ui-right { width: 30%; padding: 10px; display: flex; flex-direction: column; gap: 10px; background: #f8fafc; }
        .ui-input { border: 1px solid #999; height: 25px; background: white; }
        .ui-btn { background: #333; color: white; text-align: center; padding: 5px; margin-top: auto; font-size: 0.8rem; cursor: pointer; }
    </style>
</head>
<body>

<div class="card">
    [cite_start]<h1>H4 - Tervezési Fázis [cite: 131-206]</h1>
    <p style="text-align:center; color:#666; font-style:italic;">Részletes műszaki dokumentáció: Objektumorientált Analízis, Szoftverarchitektúra, UI és Adatbázis Tervek</p>

    <h2>1. Analízis Modell (Objektumorientált Tervezés)</h2>
    <p>A tervezési fázis első lépéseként az SRS-ben (H3) definiált funkcionális követelményeket képeztük le konkrét szoftveres objektumokra. A cél az volt, hogy a valós világ entitásait (székek, jegyek, nézők) olyan osztálystruktúrába szervezzük, amely támogatja a modularitást és az újrafelhasználhatóságot.</p>
    
    <h3>Osztálydiagram (Class Diagram)</h3>
    <p>Az alábbi diagram a rendszer statikus szerkezetét mutatja be. A központi elem a <strong>Seat</strong> (Szék) és a <strong>Booking</strong> (Foglalás) kapcsolata. Külön figyelmet érdemel a <strong>HeightValidator</strong> osztály, amely nem tárol adatot, hanem egy tiszta szolgáltatás (Service Class), felelőssége kizárólag az üzleti logika – a magasságok összehasonlítása – végrehajtása.</p>
    
    <div class="svg-container">
        <svg width="600" height="250" viewBox="0 0 600 250" xmlns="http://www.w3.org/2000/svg">
            <defs>
                <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
                    <path d="M0,0 L0,6 L9,3 z" fill="#333" />
                </marker>
            </defs>
            
            <rect x="20" y="20" width="120" height="80" fill="#eef2ff" stroke="#312e81" stroke-width="2"/>
            <text x="80" y="40" text-anchor="middle" font-weight="bold" font-family="sans-serif" font-size="14">Seat</text>
            <line x1="20" y1="50" x2="140" y2="50" stroke="#312e81"/>
            <text x="30" y="65" font-size="10" font-family="sans-serif">+row, col</text>
            <text x="30" y="80" font-size="10" font-family="sans-serif">+is_occupied</text>

            <rect x="220" y="20" width="140" height="90" fill="#eef2ff" stroke="#312e81" stroke-width="2"/>
            <text x="290" y="40" text-anchor="middle" font-weight="bold" font-family="sans-serif" font-size="14">Booking</text>
            <line x1="220" y1="50" x2="360" y2="50" stroke="#312e81"/>
            <text x="230" y="65" font-size="10" font-family="sans-serif">+id, price</text>
            <text x="230" y="80" font-size="10" font-family="sans-serif">+visitor_height</text>

            <rect x="440" y="20" width="120" height="60" fill="#eef2ff" stroke="#312e81" stroke-width="2"/>
            <text x="500" y="40" text-anchor="middle" font-weight="bold" font-family="sans-serif" font-size="14">User</text>
            <line x1="440" y1="50" x2="560" y2="50" stroke="#312e81"/>

            <rect x="220" y="160" width="140" height="60" fill="#fff" stroke="#312e81" stroke-width="2" stroke-dasharray="5,5"/>
            <text x="290" y="180" text-anchor="middle" font-weight="bold" font-family="sans-serif" font-size="14">HeightValidator</text>
            <line x1="220" y1="190" x2="360" y2="190" stroke="#312e81"/>
            <text x="230" y="205" font-size="10" font-family="sans-serif">+validate()</text>

            <line x1="140" y1="60" x2="220" y2="60" stroke="#333" stroke-width="1.5"/>
            <text x="160" y="50" font-size="10">1</text>
            <text x="200" y="50" font-size="10">0..1</text>

            <line x1="360" y1="60" x2="440" y2="60" stroke="#333" stroke-width="1.5"/>
            <text x="380" y="50" font-size="10">*</text>
            <text x="420" y="50" font-size="10">1</text>

            <line x1="290" y1="110" x2="290" y2="160" stroke="#333" stroke-width="1.5" stroke-dasharray="4,4" marker-end="url(#arrow)"/>
            <text x="300" y="140" font-size="10" font-family="sans-serif">uses</text>
        </svg>
    </div>

    <h3>Dinamikus modellezés: Szekvencia Diagram</h3>
    <p>Ez a diagram a rendszer legkritikusabb folyamatát, a <strong>"Blokkolás-ellenőrzéssel egybekötött jegyválasztást"</strong> modellezi. Jól látható, hogy a felhasználói interakció (kattintás) elindít egy láncreakciót: a Controller nem dönt egyedül, hanem lekéri az adatokat az Adatbázisból (hogy ki ül az előző sorban), majd a HeightValidator döntése alapján küld vissza ZÖLD (engedélyezett) vagy PIROS (figyelmeztető) jelzést a GUI-nak.</p>
    
    <div class="svg-container">
        <svg width="600" height="350" viewBox="0 0 600 350" xmlns="http://www.w3.org/2000/svg">
            <style>.life { stroke: #999; stroke-dasharray: 5,5; } .msg { stroke: #333; stroke-width: 1.5; marker-end: url(#arrow); } .box { fill: #eef2ff; stroke: #312e81; }</style>
            <defs><marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto"><path d="M0,0 L0,6 L9,3 z" fill="#333"/></marker></defs>

            <rect x="20" y="10" width="80" height="30" class="box"/> <text x="60" y="30" text-anchor="middle" font-size="12">User</text>
            <rect x="150" y="10" width="80" height="30" class="box"/> <text x="190" y="30" text-anchor="middle" font-size="12">GUI</text>
            <rect x="280" y="10" width="80" height="30" class="box"/> <text x="320" y="30" text-anchor="middle" font-size="12">Controller</text>
            <rect x="410" y="10" width="80" height="30" class="box"/> <text x="450" y="30" text-anchor="middle" font-size="12">Database</text>

            <line x1="60" y1="40" x2="60" y2="300" class="life"/>
            <line x1="190" y1="40" x2="190" y2="300" class="life"/>
            <line x1="320" y1="40" x2="320" y2="300" class="life"/>
            <line x1="450" y1="40" x2="450" y2="300" class="life"/>

            <line x1="60" y1="70" x2="190" y2="70" class="msg"/>
            <text x="125" y="65" text-anchor="middle" font-size="10">1. Szék kiválasztás</text>

            <line x1="190" y1="100" x2="320" y2="100" class="msg"/>
            <text x="255" y="95" text-anchor="middle" font-size="10">2. check_seat(id)</text>

            <line x1="320" y1="130" x2="450" y2="130" class="msg"/>
            <text x="385" y="125" text-anchor="middle" font-size="10">3. get_row_in_front()</text>

            <line x1="450" y1="160" x2="320" y2="160" class="msg" style="stroke-dasharray: 3,3;"/>
            <text x="385" y="155" text-anchor="middle" font-size="10">4. adatok</text>

            <rect x="180" y="180" width="280" height="100" fill="none" stroke="#ccc" stroke-dasharray="5,5"/>
            <text x="210" y="195" font-size="10" font-weight="bold">[Blokkolás]</text>
            <line x1="320" y1="210" x2="190" y2="210" class="msg"/>
            <text x="255" y="205" text-anchor="middle" font-size="10" fill="red">PIROS jelzés</text>

            <line x1="180" y1="230" x2="460" y2="230" stroke="#ccc" stroke-dasharray="5,5"/> <text x="210" y="245" font-size="10" font-weight="bold">[OK]</text>
            
            <line x1="320" y1="260" x2="190" y2="260" class="msg"/>
            <text x="255" y="255" text-anchor="middle" font-size="10" fill="green">ZÖLD jelzés</text>
        </svg>
    </div>

    <h2>2. Rendszertervezés (Szoftverarchitektúra)</h2>
    <p>A rendszer stabilitása és fenntarthatósága érdekében a fejlesztés során a szigorú <strong>rétegelt architektúra (Layered Architecture)</strong> elveit követjük, konkrétan az <strong>MVC (Model-View-Controller)</strong> mintát. Ez biztosítja, hogy a felhasználói felület változtatása (pl. új gombok) ne tegye tönkre az üzleti logikát.</p>
    
    <table>
        <tr>
            <th>Réteg</th>
            <th>Komponensek (Python Modulok)</th>
            <th>Felelősségi kör</th>
        </tr>
        <tr>
            <td><strong>View (Megjelenítés)</strong></td>
            <td><code>MainFrame.py</code>, <code>Dialogs.py</code></td>
            <td>A grafikus felület (GUI) kirajzolása Tkinter segítségével. Kizárólag megjelenítési logikát tartalmaz, üzleti döntéseket nem hoz.</td>
        </tr>
        <tr>
            <td><strong>Controller (Vezérlés)</strong></td>
            <td><code>BookingController.py</code>, <code>AuthController.py</code></td>
            <td>Az "agy". Fogadja a View eseményeit (kattintás), validálja a bemenetet, meghívja a Modelt, majd frissíti a Nézetet.</td>
        </tr>
        <tr>
            <td><strong>Model (Adat és Logika)</strong></td>
            <td><code>SeatEntity.py</code>, <code>PricingService.py</code></td>
            <td>Az adatok szerkezetét (osztályok) és a tiszta üzleti szabályokat (pl. "Gyerekjegy = 50% ár") tartalmazza. Független a GUI-tól.</td>
        </tr>
        <tr>
            <td><strong>Infrastructure (Perzisztencia)</strong></td>
            <td><code>DatabaseManager.py</code> (SQLite)</td>
            <td>Az adatok fizikai tárolásáért és betöltéséért felelős réteg (DAO minta).</td>
        </tr>
    </table>

    <h2>3. Felhasználói Felület (UI) Tervek</h2>
    <p>A felhasználói élmény (UX) tervezésekor a hatékonyság volt az elsődleges szempont. A pénztárosoknak gyorsan kell dolgozniuk, ezért "egyablakos" elrendezést választottunk. Az alábbi drótváz (wireframe) bemutatja az elrendezést: bal oldalon a vizuális nézőtér térkép, jobb oldalon pedig a tranzakciós panel.</p>
    
    <div class="ui-mockup">
        <div class="ui-left">
            <div class="seat"></div><div class="seat"></div><div class="seat"></div><div class="seat"></div><div class="seat"></div>
            <div class="seat red"></div><div class="seat green"></div><div class="seat"></div><div class="seat"></div><div class="seat"></div>
            <div class="seat"></div><div class="seat"></div><div class="seat red"></div><div class="seat red"></div><div class="seat"></div>
        </div>
        <div class="ui-right">
            <div style="font-size:0.8rem; font-weight:bold;">Tranzakció</div>
            <div style="font-size:0.7rem; margin-top:10px;">Kiválasztva: Sor 2, Szék 5</div>
            <div style="font-size:0.7rem; margin-top:10px;">Látogató magassága (cm):</div>
            <div class="ui-input"></div>
            <div class="ui-btn">ELLENŐRZÉS & FIZETÉS</div>
        </div>
    </div>
    <p style="text-align: center; font-size: 0.9rem; color: #666;"><em>Balra: Interaktív ülésmátrix | Jobbra: Adatbeviteli és fizetési panel</em></p>

    <h2>4. Adatbázis Terv (ER Diagram)</h2>
    <p>Az adatok tárolására relációs adatbázist (RDBMS) használunk. Az adatbázis sémáját a <strong>3. normálformára (3NF)</strong> hoztuk a redundancia elkerülése érdekében. A legfontosabb kapcsolat az "Egy-a-Többhöz" (1:N) kapcsolat a Székek és a Foglalások között, hiszen egy székre az idők folyamán több foglalás is érkezhet (különböző előadásokra).</p>
    
    <div class="svg-container">
        <svg width="500" height="200" viewBox="0 0 500 200" xmlns="http://www.w3.org/2000/svg">
            <defs><marker id="crowfoot" markerWidth="12" markerHeight="12" refX="11" refY="6" orient="auto"><path d="M0,6 L10,6 M10,0 L10,12 M0,0 L10,6 L0,12" fill="none" stroke="#333" stroke-width="1"/></marker></defs>
            
            <rect x="20" y="50" width="100" height="80" fill="#fff" stroke="#333" stroke-width="2"/>
            <text x="70" y="70" text-anchor="middle" font-weight="bold" font-size="14">Shows</text>
            <line x1="20" y1="80" x2="120" y2="80" stroke="#333"/>

            <rect x="200" y="50" width="100" height="80" fill="#e0e7ff" stroke="#333" stroke-width="2"/>
            <text x="250" y="70" text-anchor="middle" font-weight="bold" font-size="14">Bookings</text>
            <line x1="200" y1="80" x2="300" y2="80" stroke="#333"/>
            <text x="250" y="100" text-anchor="middle" font-size="10">FK: seat_id</text>
            <text x="250" y="115" text-anchor="middle" font-size="10">visitor_height</text>

            <rect x="380" y="50" width="100" height="80" fill="#fff" stroke="#333" stroke-width="2"/>
            <text x="430" y="70" text-anchor="middle" font-weight="bold" font-size="14">Seats</text>
            <line x1="380" y1="80" x2="480" y2="80" stroke="#333"/>
            <text x="430" y="100" text-anchor="middle" font-size="10">PK: id</text>

            <line x1="120" y1="90" x2="200" y2="90" stroke="#333" stroke-width="1.5" marker-end="url(#crowfoot)"/>
            <line x1="300" y1="90" x2="380" y2="90" stroke="#333" stroke-width="1.5" />
            <circle cx="370" cy="90" r="3" fill="white" stroke="#333"/>
            <line x1="373" y1="85" x2="373" y2="95" stroke="#333"/>
        </svg>
    </div>

    <h2>5. Frissített Szótár (H4)</h2>
    <p>A tervezési fázisban bevezetett technikai fogalmak definíciói:</p>
    <ul>
        <li><strong>MVC (Model-View-Controller):</strong> Egy tervezési minta, amely három részre bontja az alkalmazást a kód átláthatósága és tesztelhetősége érdekében.</li>
        <li><strong>DAO (Data Access Object):</strong> Egy objektum, amely absztrakt interfészt biztosít az adatbázis felé, elrejtve az SQL lekérdezések bonyolultságát az üzleti logika elől.</li>
        <li><strong>Event Loop:</strong> A grafikus felület (GUI) végtelen ciklusa, amely folyamatosan figyeli a felhasználói interakciókat (pl. kattintásokat) és frissíti a képernyőt.</li>
    </ul>
</div>

</body>
</html>